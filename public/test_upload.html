<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Upload</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
        }
        .upload-box {
            border: 2px dashed #667eea;
            padding: 30px;
            border-radius: 10px;
            background: #f8f9fa;
        }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 10px;
        }
        button:hover {
            background: #5568d3;
        }
        .preview {
            margin-top: 20px;
            max-width: 300px;
        }
        .preview img {
            max-width: 100%;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .status {
            margin-top: 15px;
            padding: 12px;
            border-radius: 6px;
            font-weight: bold;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <h1>üß™ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</h1>
    
    <div class="upload-box">
        <h3>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (JPG, PNG, GIF, WebP)</h3>
        <input type="file" id="imageFile" accept="image/*" style="margin-bottom: 10px;">
        <br>
        <button onclick="testUpload()">üöÄ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î</button>
        
        <div id="status"></div>
        <div id="preview" class="preview"></div>
    </div>

    <script>
        async function testUpload() {
            const statusDiv = document.getElementById('status');
            const previewDiv = document.getElementById('preview');
            const fileInput = document.getElementById('imageFile');
            
            // Clear previous status
            statusDiv.innerHTML = '';
            previewDiv.innerHTML = '';
            
            console.log('üîç ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö...');
            
            // Check file input
            if (!fileInput) {
                statusDiv.innerHTML = '<div class="status error">‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö input field</div>';
                console.error('‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö input field');
                return;
            }
            console.log('‚úÖ ‡∏û‡∏ö input field');
            
            // Check files
            if (!fileInput.files || fileInput.files.length === 0) {
                statusDiv.innerHTML = '<div class="status error">‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏Å‡πà‡∏≠‡∏ô</div>';
                console.error('‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå');
                return;
            }
            console.log('‚úÖ ‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå:', fileInput.files[0].name);
            
            const file = fileInput.files[0];
            
            // Validate file size
            console.log('üì¶ ‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå:', (file.size / 1024 / 1024).toFixed(2), 'MB');
            if (file.size > 5 * 1024 * 1024) {
                statusDiv.innerHTML = '<div class="status error">‚ùå ‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô 5MB</div>';
                console.error('‚ùå ‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô');
                return;
            }
            console.log('‚úÖ ‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå OK');
            
            // Validate file type
            console.log('üìÑ ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÑ‡∏ü‡∏•‡πå:', file.type);
            const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
            if (!allowedTypes.includes(file.type)) {
                statusDiv.innerHTML = '<div class="status error">‚ùå ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞ JPG, PNG, GIF, WebP</div>';
                console.error('‚ùå ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö');
                return;
            }
            console.log('‚úÖ ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÑ‡∏ü‡∏•‡πå OK');
            
            // Create FormData
            const formData = new FormData();
            formData.append('image', file);
            console.log('üì¶ ‡∏™‡∏£‡πâ‡∏≤‡∏á FormData ‡πÅ‡∏•‡πâ‡∏ß');
            
            // Show uploading status
            statusDiv.innerHTML = '<div class="status info">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î...</div>';
            console.log('üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î...');
            
            try {
                const response = await fetch('/api/upload', {
                    method: 'POST',
                    body: formData
                });
                
                console.log('üì° Response status:', response.status);
                
                const data = await response.json();
                console.log('üì¶ Response data:', data);
                
                if (data.success && data.imageUrl) {
                    statusDiv.innerHTML = '<div class="status success">‚úÖ ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!<br>URL: ' + data.imageUrl + '</div>';
                    previewDiv.innerHTML = '<img src="' + data.imageUrl + '" alt="Preview">';
                    console.log('‚úÖ ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:', data.imageUrl);
                } else {
                    statusDiv.innerHTML = '<div class="status error">‚ùå ' + (data.error || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î') + '</div>';
                    console.error('‚ùå Error:', data.error);
                }
            } catch (error) {
                statusDiv.innerHTML = '<div class="status error">‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message + '</div>';
                console.error('‚ùå Exception:', error);
            }
        }
        
        // Auto test when file is selected
        document.getElementById('imageFile').addEventListener('change', function() {
            if (this.files && this.files.length > 0) {
                console.log('üìÅ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå:', this.files[0].name);
            }
        });
        
        console.log('‚úÖ Test page loaded');
        console.log('üìç ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà: http://localhost:3000/test_upload.html');
    </script>
</body>
</html>
